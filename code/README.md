## Installation

1. Obtain the anonymized data from "https://drive.google.com/drive/folders/1dMpbYklf4zU4IGlR2OG5AA3nmf45_nJy?usp=sharing" and keep the data according to the following directory structure:
```
.
├─data
├───data_A_anonymized
├─────food_data
├─────map
├───data_B_anonymized
├─────food_data
├─────map
├───data_C_anonymized
├─────food_data
├─────map
├─results
└─scripts
```

2. Generate the index structures for road networks:
    We use the Hierarchical Hub Labeling code from the following repository [savrus/hl](https://github.com/savrus/hl).  
```bash
    bash scripts/generate_index.sh
```
3. Compile the project:
```bash
    make main.o
```

## Running the code

1. Simulation:  
    - Usage
    ```bash
        ./main.o [-algo algorithm_name] [-city city_name] [-day day_num] [-eta eta_num] [-k k_num] [-gamma gamma_num] [-delta delta_num] [-start start_num] [-end end_num]
    ```
    - The parameters are explained below:
        - **algorithm_name**: Name of assigment algorithm to use \[Default: FAIR_FOODY\]  
        ```
        'FAIR_FOODY' = FairFoody implimentation
        'FM_FULL' = FoodMatch implimentation proposed by Jhoshi et. al. [1], we have reused code provided by [3] in our implementation.
        '2SF' = two sided fairness  implimentation proposed by Suhr et. al. [2] (Note lambda is 0.98)
          ```
        - **city_name**: Name of city to run algorithm on \[Default: A\]  
        ```
        '{A, B, C}'
        ```
        - **day_num**: Day for which the algorithm should be run on \[Default: 1\]
        ```
        '{1,2,3,4,5,6}'
        ```
        - **eta_num**: Eta value used in stopping criteria for clustering \[Default: 60\]
        - **k_num**: K value used in fraction of edges to use in BFS \[Default: 200\]
        - **gamma_num**: Gamma value used in weight of heuristic function \[Default: 0.5\]
        - **delta_num**: Accumulation window used \[Default: 180\]
        - **start_num**: Start hour of simulation in 24-hour format \[Default: 0\]
        - **end_num**: End hour of simulation in 24-hour format \[Default: 24\]
    - Sample command:
    ```bash
        ./main.o -algo FAIR_FOODY -city A -day 1 -eta 60 -k 200 -gamma 0.5 -delta 180 -start 0 -end 24 > sim.results
    ```

2. Evaluation:  
    - Usage  
    ```bash
    python3 scripts/evaluation_script.py [--input_file simulation_log] [--output_file output_file] [--start start_num] [--end end_num] [--delta delta_num] 
    ``` 
    - The parameters are explained below:
        - **simulation_log**: Simulation log generated by `main.o` \[Required\]
        - **output_file**: File to which metrics are written \[Required\]
        - **start_num**: Start hour of simulation in 24-hour format \[Required\]
        - **end_num**: End hour of simulation in 24-hour format \[Required\]
        - **delta_num**: Accumulation window used \[Required\]
    - Sample command:
```bash
        python3 scripts/evaluation_script.py --input_file sim.results --output_file metrics.results --start 0 --end 24 --delta 180 
```

## Code Description
- `main.cpp` - contains the code that drives the simulation.<br>
    It produces a log of simulation on stdout. This is piped to a file for evaluation.
- `include/` - contains code for the simulation framework and algorithms.
- `include/constants.cpp` - contains the default parameters used.
- `include/vehicle_assignment.cpp` - contains the code for FairFoody,FoodMatch and 2SF algorithms.
- `evaluation_scripts/evaluation_script.py` - reads the simulation log and reports metrics defined in our paper.

## References

[1] M.  Joshi,  A.  Singh,  S.  Ranu,  A.  Bagchi,  P.  Karia,  and  P.  Kala,“Batching and matching for food delivery in dynamic road networks,”inProc. ICDE, 2021.<br>
[2] T. Suhr, A. J. Biega, M. Zehlike, K. P. Gummadi, and A. Chakraborty,“Two-sided  fairness  for  repeated  matchings  in  two-sided  markets:  Acase study of a ride-hailing platform,” inACM KDD, 2019.<br>
[3] https://github.com/idea-iitd/FoodMatch

